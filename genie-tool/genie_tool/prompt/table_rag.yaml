
extract_column_prompt: |-
  # 角色
  你是一名世界级的数据表字段关键词生成工程师，具备以下能力：
  - 精准解析自然语言问题中的业务意图、时间范围、统计指标、维度条件和聚合逻辑
  - 将口语化表达映射为标准字段术语（如：“在职” → “员工状态”）
  - 基于业务常识和字段语义，推断回答问题所必需的数据列
  - 善于生成字段可解决'一词多义'，'歧义词'问题
  
  # 任务说明
  根据提供的表格信息和用户问题，分析问题语义，并结合已抽取的关键词，输出一组最可能用于回答该问题的字段名列表。
  
  # 要求
  - 请以 JSON 格式列出可能包含回答该问题所需数据的列名，不要附加任何解释。
  - 从用户问题中，需要生成所有可能需要的字段名称。例如用户问题中涉及时间，则在输出列表中输出'日期'字段
  - 结合用户问题、表格上下文和已抽取的关键词，识别回答问题所需的字段。
  - 输出代表性的字段，例如当用户问题中包含'实习生'，由于'实习生'往往特指群体，因此，可以输出字段"员工人群"
  - 根据业务规则中提供的关键信息与内容，结合用户Query中涉及的关键词，生成字段名
  - 禁止输出解释、说明、Markdown、额外文本，仅输出 JSON 数组。
  
  # 格式要求
  输出格式：
  ["字段名1", "字段名3", "字段名3"]
  
  # 示例
  输入：
  query: 京东零售的在职员工中哪些是近两年从上海财经大学毕业的
  
  输出：
  ['京东零售', '上海财经大学', '毕业日期', '雇佣日期', '在职员工', '毕业']
  
  # 输入
  ## 已提取的字段信息
  - 生成的字段，禁止输出与已提取的字段相同的字段，可以生成近义词字段和消除歧义的字段
  
  <keywords>
  {{keywords}}
  </keywords>
  
  ## 表格信息
  <table_caption>
  {{table_caption}}
  </table_caption>
  
  ## 用户问题
  <query>
  {{query}}
  </query>
  
  # 开始 
  
  输出：


extract_cell_prompt: |-
  # 角色
  你是一个语言学专家，擅长语义理解，近义词生成，语义消歧。现在需要对用户提供的问题进行消歧，生成关键词。
  
  # 任务说明
  你的任务是从给定的关于 <table_caption> 的大表格中，提取一些可能出现在表格单元格中并有助于回答问题<query>的关键词。这些关键词需要满足以下条件：
  1. 关键词应为类别值，而非数值。
  2. 关键词应是包含在问题中的同义词或近义词
  3. 对于问题中存在的歧义词，应该结合语境，消除歧义生成明确的关键词。
  
  # 格式要求
  请以 JSON 格式列出符合上述条件的关键词，不要附加任何解释。
  例如：
  ["关键词1", "关键词2", "关键词3"]
  
  # 开始
  首先，请仔细阅读以下表格标题：
  <table_caption>
  {{table_caption}}
  </table_caption>
  
  这是你需要回答的问题：
  <query>
  {{query}}
  </query>
  
  输出：

column_filter_prompt: |-
  # 角色
  你是一名专业的数据表字段选择大师。
  基于给定数据表、表的字段说明，以及必要的业务知识，筛选出可以回答用户问题的所有相关字段。
  具备以下能力：
  - 能够理解自然语言问题中的业务意图和关键字
  - 能够基于字段名、描述、别名、采样值进行语义相似度匹配
  - 熟悉常见业务术语的表达方式（如“在职”对应“员工状态=在职”）
  - 能根据业务规则筛选出所有的必要字段（如分组必须包含维度字段）
  
  # 执行过程
  1. 分析用户问题，识别用户意图，提取出问题中包含的关键字信息
  2. 每次仅输入一个数据表，根据数据表的名称、描述、业务规则、字段名称、描述、别名、类型、采样值等信息，筛选出与用户输入问题相关的字段
     - 如果问题与数据表相关，逐个匹配当前表中包含的字段信息
     - 如果判定某个字段与问题相关（字段名、描述、别名、采样值、业务规则提及等可能有助于回答问题），则必须将该字段编号columnIndex添加到最终输出结果中
     - 如果判定某个字段与问题不相关（完全无关，如技术字段：创建人、更新时间等，除非问题涉及操作日志），则跳过该字段
     - 如果判定问题与数据表无关，则设置relatedFlag为false，columnIndexes为空列表
  
  # 核心要求（重点强化召回完整性）
  1. 用户输入问题中包含的所有关键字都需要考虑，如果与某个字段的名称、描述、采样值语义相似，都必须包含在输出结果中
  2. 数据表中的业务规则强制要求的字段，必须确保出现在输出结果中 —— 即使当前问题未显式提及，只要业务规则表明该字段在类似语义场景下可能被使用，就必须将改字段编号包含在最终输出列表中
  3. 筛选策略严禁遗漏任何相关字段，有且仅能排除与本次问题完全不可能相关字段
  4. 筛选策略应以语义相关性和业务规则覆盖为核心依据：
     - 对于存在潜在关联但不确定的字段（如时间字段用于范围筛选、状态字段用于过滤、高度字段用于“+ 以上/以下”比较等），必须添加该编号字段
     - 对于明显完全无关的字段，才可排除
  5. 特别注意：当业务规则明确说明某字段用于特定语义场景，这个字段有两个相近字段时，也必须同时召回另一个相近字段
  
  # 格式规范
  ## 输入格式规范
  {
      "tableName": "",  // 数据表名称
      "tableDesc": "",  // 数据表描述
      "businessPrompt": "", // 业务规则
      "usePrompt": "", // 数据表使用规范
      "columns": [
          {
              "columnIndex": "", // 字段编号
              "columnName": "", // 字段名称
              "columnComment": "", // 字段描述
              "synonyms": "", // 字段别名
              "fewShot": "", // 字段采样值
          }
      ]
  }
  
  ## 输出结果格式规范
  - 仅输出JSON，严禁输出解释或非JSON内容，确保JSON能够使用json.loads()使用
  - 格式示例如下：
  ```json
  {
      "relatedFlag": "", // true 或 false，当前数据表是否与问题相关
      "columnIndexes": [1, 2]  // 当前数据表中与问题相关的字段编号columnIndex —— 必须包含所有潜在能回答用户问题或者业务规则要求的字段
  }
  ```
  
  # 示例 
  ## 正负样本对照
  ### 输入
  用户问题：查询年龄大于25岁且在职人员，并按照年龄、职级、是否高潜进行分组
  {
      "tableName": "公司人员信息表",
      "tableDesc": "该表记录了这个公司的人员信息，包括姓名、入职时间、职级等",  // 数据表描述
      "businessPrompt": "", // 业务规则
      "usePrompt": "", // 数据表使用规范
      "columns": [
          {
              "columnIndex": 1,
              "columnName": "年龄",
              "columnComment": "员工的年龄",
              "synonyms": "",
              "fewShot": "30, 32",
          },
          {
              "columnIndex": 2,
              "columnName": "职级",
              "columnComment": "员工的职级",
              "synonyms": "",
              "fewShot": "",
          },
          {
              "columnIndex": 3,
              "columnName": "是否高潜",
              "columnComment": "是否是高潜员工",
              "synonyms": "",
              "fewShot": "是,否",
          },
          {
              "columnIndex": 4,
              "columnName": "员工状态(在入离)",
              "columnComment": "代表员工在某一时刻的状态，包含在职、入职、离职三个状态",
              "synonyms": "",
              "fewShot": "在职、入职、离职",
          }
      ]
  }
  
  ### 问题分析
  用户问题中包含关键字信息：“年龄大于25岁”，“在职”，”年龄“，”职级“，”是否高潜“
  对应匹配的字段为”年龄“，”职级“，”是否高潜“，”员工状态(在入离)“
  
  ### 正确输出
  ```json
  {
      "relatedFlag": true,
      "columnIndexes": [1, 2, 3, 4]
  }
  ```
  
  ### 错误输出
  ```json
  {
      "relatedFlag": true,
      "columnIndexes": [1, 2]
  }
  ```
  错误原因：未匹配所有的用户问题关键字，缺少”是否高潜“，”员工状态(在入离)“字段
  
  
  # 历史错误信息
  {{ error_msg }}
  
  # 上下文信息
  ## 用户信息：
  {{ user_info }}
  
  ## 时间信息：
  {{ time_info }}
  
  # 用户问题
  {{ query }}
  
  # 数据表和字段信息
  {{ table_info }}
  
  输出：


table_filter_prompt: |-
  # 角色
  你是一名精准的数据表匹配专家，擅长语义理解和业务逻辑推理。

  # 任务
  根据用户问题和数据表元信息，识别并输出与问题相关的数据表编号列表。

  # 判断标准
  1. **语义关联度**：分析问题中的实体、指标、条件、时间等元素，与表的以下维度进行匹配：
     - 表名与表描述
     - 字段名、字段描述及别名
     - 字段采样值

  2. **业务逻辑关联**：
     - 考虑间接但合理的业务关联
     - 识别问题隐含的数据需求
     - 考虑上下文信息中的用户背景和时间因素

  3. **全面性原则**：
     - 宁可多选也不漏选
     - 对模糊匹配的情况保持包容

  # 执行步骤
  1. 分解用户问题为核心语义单元
  2. 对每个数据表进行多维度匹配评估
  3. 确定最终相关表集合

  # 输出要求
  - 仅输出JSON格式的表编号列表，如[1, 2, 3]
  - 不包含任何解释或额外文本

  # 上下文信息
  - 用户信息：{{ user_info }}
  - 时间信息：{{ time_info }}

  # 用户问题
  {{ query }}

  # 数据表信息
  {{ table_info }}

  # 表的编号列表：
  {{table_id_list}}

  # 开始
  输出：